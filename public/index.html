<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fitness RPG - Level Up IRL</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/chao-stats.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- Floating clouds -->
  <div class="clouds">
    <div class="cloud"></div>
    <div class="cloud"></div>
    <div class="cloud"></div>
    <div class="cloud"></div>
    <div class="cloud"></div>
  </div>

  <div class="container">
    <!-- Header -->
    <header>
      <h1>‚öîÔ∏è Fitness RPG</h1>
      <p class="tagline">Level up by working out in real life</p>
    </header>

    <!-- Welcome Screen (shown when not authenticated) -->
    <div id="welcomeScreen" class="screen">
      <div class="welcome-card">
        <h2>Welcome, Adventurer!</h2>
        <p>Connect your Strava account to start your fitness journey.</p>
        <p class="description">
          Every workout you do earns XP. Build your Strength and Endurance stats.
          Level up and compete with friends!
        </p>
        <a href="/auth/strava/connect" class="btn btn-primary btn-large">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/>
          </svg>
          Connect with Strava
        </a>
        <p class="note">Free to use ‚Ä¢ Privacy focused ‚Ä¢ Open source</p>
      </div>
    </div>

    <!-- Dashboard (shown when authenticated) -->
    <div id="dashboardScreen" class="screen" style="display: none;">

      <!-- Import Status (shown while importing) -->
      <div id="importStatus" class="import-status" style="display: none;">
        <div class="import-header">
          <span id="importStatusText">‚è≥ Importing activities...</span>
          <span id="importProgress">--</span>
          <button id="dismissImport" class="btn-dismiss" style="display: none;" title="Dismiss">‚úï</button>
        </div>
        <div class="progress-bar">
          <div id="importProgressFill" class="progress-fill import animated"></div>
        </div>
      </div>

      <!-- Tab Navigation -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="stats">My Stats</button>
        <button class="tab-btn" data-tab="friends">Friends</button>
        <button class="tab-btn" data-tab="leaderboards">Leaderboards</button>
      </div>

      <!-- Stats Tab -->
      <div id="statsTab" class="tab-content active">
      <!-- Chao Garden Stats Dashboard -->
      <div class="chao-stats-container" id="chaoStatsContainer">
        <!-- Header -->
        <div class="chao-header">
          <div class="chao-character-name" id="chaoCharacterName">Loading...</div>
          <div class="chao-character-level" id="chaoCharacterLevel">Level --</div>
          <div class="chao-overall-progress">
            <div class="chao-overall-progress-bar">
              <div class="chao-overall-progress-fill" id="chaoOverallProgressFill" style="width: 0%"></div>
            </div>
            <div class="chao-overall-progress-text" id="chaoOverallProgressText">0 / 0 XP</div>
          </div>
        </div>

        <!-- Stats Container -->
        <div class="chao-stats-box">
          <div class="chao-stats-grid" id="chaoStatsGrid">
            <div class="chao-loading">Loading stats...</div>
          </div>
        </div>

        <!-- Activities Section -->
        <div class="chao-activities-section">
          <div class="chao-activities-header">Recent Activities</div>
          <div id="chaoActivitiesList">
            <div class="chao-loading">Loading activities...</div>
          </div>
        </div>
      </div>
      </div>
      <!-- End Stats Tab -->

      <!-- Friends Tab -->
      <div id="friendsTab" class="tab-content">
        <!-- Friend Search -->
        <div class="card friend-search">
          <h3>Add Friends</h3>
          <div class="search-container">
            <input type="text" id="friendSearchInput" placeholder="Search by username or name..." class="search-input">
            <button id="searchBtn" class="btn btn-primary">Search</button>
          </div>
          <div id="searchResults" class="search-results"></div>
        </div>

        <!-- Friend Requests -->
        <div id="friendRequestsCard" class="card friend-requests" style="display: none;">
          <h3>Friend Requests</h3>
          <div id="friendRequestsList" class="friend-requests-list"></div>
        </div>

        <!-- Friends List -->
        <div class="card friends-list">
          <h3>My Friends</h3>
          <div id="friendsList" class="friends-grid">
            <p class="loading">Loading...</p>
          </div>
        </div>
      </div>
      <!-- End Friends Tab -->

      <!-- Leaderboards Tab -->
      <div id="leaderboardsTab" class="tab-content">
        <!-- Category Selector -->
        <div class="card leaderboard-controls">
          <h3>Global Rankings</h3>
          <div class="period-selector">
            <button class="period-btn active" data-period="all_time">All Time</button>
            <button class="period-btn" data-period="weekly">This Week</button>
          </div>
          <div class="category-selector">
            <select id="leaderboardCategory" class="category-select">
              <option value="level">Overall Level</option>
              <option value="strength">üí™ Strength</option>
              <option value="endurance">üèÉ Endurance</option>
              <option value="agility">‚ö° Agility</option>
              <option value="activities">üéØ Total Activities</option>
            </select>
            <button id="sportFilterBtn" class="btn btn-secondary">By Sport</button>
          </div>
        </div>

        <!-- Sport Filter (hidden by default) -->
        <div id="sportFilterCard" class="card sport-filter" style="display: none;">
          <h3>Filter by Sport</h3>
          <div id="sportButtons" class="sport-buttons">
            <p class="loading">Loading sports...</p>
          </div>
          <button id="closeSportFilter" class="btn btn-secondary">Back to Overall</button>
        </div>

        <!-- Your Ranking Card -->
        <div id="userRankingCard" class="card user-ranking">
          <h3>Your Ranking</h3>
          <div id="userRanking" class="user-ranking-content">
            <p class="loading">Loading...</p>
          </div>
        </div>

        <!-- Leaderboard List -->
        <div class="card leaderboard-card">
          <h3 id="leaderboardTitle">Top Athletes</h3>
          <div id="leaderboardList" class="leaderboard-list">
            <p class="loading">Loading leaderboard...</p>
          </div>
        </div>
      </div>
      <!-- End Leaderboards Tab -->

      <!-- Friend Comparison Modal -->
      <div id="compareModal" class="modal" style="display: none;">
        <div class="modal-content">
          <div class="modal-header">
            <h2>‚öîÔ∏è Stat Comparison</h2>
            <button class="modal-close" id="closeCompare">‚úï</button>
          </div>
          <div class="modal-body">
            <div class="comparison-users">
              <div class="comparison-user">
                <img id="compareUser1Avatar" class="comparison-avatar" src="" alt="">
                <h3 id="compareUser1Name">You</h3>
                <p id="compareUser1Level" class="comparison-level">Level --</p>
              </div>
              <div class="comparison-vs">VS</div>
              <div class="comparison-user">
                <img id="compareUser2Avatar" class="comparison-avatar" src="" alt="">
                <h3 id="compareUser2Name">Friend</h3>
                <p id="compareUser2Level" class="comparison-level">Level --</p>
              </div>
            </div>

            <div class="comparison-chart">
              <canvas id="compareChart"></canvas>
            </div>

            <div class="comparison-stats">
              <table class="stats-table">
                <thead>
                  <tr>
                    <th>Stat</th>
                    <th id="compareTableUser1">You</th>
                    <th id="compareTableUser2">Friend</th>
                  </tr>
                </thead>
                <tbody id="compareTableBody">
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Footer -->
    <footer>
      <p>Powered by <a href="https://www.strava.com" target="_blank">Strava</a></p>
      <p><a href="https://github.com/lethalgem/fitness-rpg" target="_blank">View on GitHub</a></p>
    </footer>
  </div>

  <script src="/chao-stats.js"></script>
  <script src="/app.js"></script>
</body>
</html>
